// pipeline {
//   agent any
//  environment {
//     GIT_URL = "https://github.com/giulia-franco/formazione_sou_k8s" 
//     DOCKER_CREDENTIALS = 'DOCKER_CREDENTIALS'
//     KUBECONFIG = "/kubeconfig/config"
//   }
//     stage('Clona repo') {
//       steps {
//         script{
//             git url: "${GIT_URL}"
//         }
//       }
//     }
//     stage('mostra elenco file'){
//         steps {
//             script{
//                 sh 'ls -la'
//             }
//         } 
//     }
// }    
//     stage('Lista helm') {
//         steps('Install Helm chart') {
//             sh "helm list"
//             sh "helm install ${NOME} /home/jenkins/workspace/flask-app-example-build/charts/helm-chart -n formazione-sou --set image.tag=${TAG} "
//             }
//         }
        




pipeline {
    agent any
        environment {
        GIT_URL = "https://github.com/giulia-franco/formazione_sou_k8s" 
        NOME= "chart"
        TAG= "latest"
        }
    stages {
        stage('Pulizia workspace') {
            steps {
                cleanWs(deleteDirs: true, patterns: [[pattern: '.kube', type: 'EXCLUDE']])
            }
        }
        stage('Test kubectl') {
            steps {
                script{
                    sh 'echo $HOME'
                    sh 'kubectl --insecure-skip-tls-verify --kubeconfig $HOME/.kube/config get nodes'
                }
            }
        }
        stage('Clona repo') {
            steps {
                script{
                    git url: "${GIT_URL}", branch:"main"
                }
            }
        }
        stage('mostra elenco file'){
            steps {
                script{
                    sh 'ls -la'
                }
            } 
        }
        stage('Lista helm') {
            steps('Install Helm chart') {
                script{
                    sh "helm install --kube-insecure-skip-tls-verify ${NOME} /home/jenkins/workspace/flask-app-example-build/charts/helm-chart -n formazione-sou --set image.tag=${TAG} "
                    sh "helm list --kube-insecure-skip-tls-verify"
                }
            }
        }    
    }
}




